# トレーサビリティマトリクス

**文書バージョン**: 1.0  
**作成日**: 2025-11-25  
**プロジェクト名**: Code RAG System (Indexer + Embedding Server + MCP Server)

---

## 凡例

| 記号 | 意味 |
|------|------|
| ● | 主要対応機能（この機能で要件を満たす） |
| ○ | 副次対応機能（補助的に関連） |
| △ | 部分対応（Phase 1で一部実装） |
| - | Phase 2以降の実装予定 |
| 空白 | 非対応 |

---

## 1. Indexer 機能トレーサビリティマトリクス

### 1.1 入力・除外機能

| 要件ID | 要件概要 | IDX-F01<br>ファイル<br>入力 | IDX-F02<br>除外<br>パターン | IDX-F03<br>AST<br>解析 | IDX-F04<br>メタ<br>データ | IDX-F05<br>ベクトル<br>化要求 | IDX-F06<br>Qdrant<br>登録 | IDX-F07<br>コレク<br>ション | IDX-F08<br>並列<br>処理 |
|--------|---------|------------|------------|------------|------------|------------|------------|------------|------------|
| **IDX-IN-001** | ローカルディレクトリ入力 | ● | | | | | | | |
| **IDX-IN-002** | Gitリポジトリクローン | - | | | | | | | |
| **IDX-IN-003** | YAML設定ファイル読込 | ● | ○ | | | | | ○ | ○ |
| **IDX-IN-101** | .ragignore除外パターン | | ● | | | | | | |
| **IDX-IN-102** | バイナリファイル除外 | | ● | | | | | | |
| **IDX-IN-103** | 拡張子フィルタ | | ● | | | | | | |

### 1.2 AST構造分析機能

| 要件ID | 要件概要 | IDX-F01<br>ファイル<br>入力 | IDX-F02<br>除外<br>パターン | IDX-F03<br>AST<br>解析 | IDX-F04<br>メタ<br>データ | IDX-F05<br>ベクトル<br>化要求 | IDX-F06<br>Qdrant<br>登録 | IDX-F07<br>コレク<br>ション | IDX-F08<br>並列<br>処理 |
|--------|---------|------------|------------|------------|------------|------------|------------|------------|------------|
| **IDX-AST-001** | 多言語AST解析 | | | ● | | | | | |
| **IDX-AST-002** | 関数単位分割 | | | ● | ○ | | | | |
| **IDX-AST-003** | 構文エラースキップ | | | ● | | | | | |
| **IDX-AST-004** | 不完全コード登録 | | | ● | | | | | |

### 1.3 メタデータ抽出機能

| 要件ID | 要件概要 | IDX-F01<br>ファイル<br>入力 | IDX-F02<br>除外<br>パターン | IDX-F03<br>AST<br>解析 | IDX-F04<br>メタ<br>データ | IDX-F05<br>ベクトル<br>化要求 | IDX-F06<br>Qdrant<br>登録 | IDX-F07<br>コレク<br>ション | IDX-F08<br>並列<br>処理 |
|--------|---------|------------|------------|------------|------------|------------|------------|------------|------------|
| **IDX-AST-101** | 関数名・引数・戻り値 | | | ○ | ● | | | | |
| **IDX-AST-102** | クラス階層・継承 | | | ○ | ● | | | | |
| **IDX-AST-103** | 依存関係(import) | | | ○ | ● | | | | |
| **IDX-AST-104** | コメント・docstring | | | ○ | ● | | | | |
| **IDX-AST-105** | スコープ情報 | | | ○ | ● | | | | |
| **IDX-AST-106** | 修飾子 | | | ○ | ● | | | | |
| **IDX-AST-107** | 位置情報 | | | ○ | ● | | | | |
| **IDX-AST-108** | 呼び出し関係 | | | ○ | ● | | | | |
| **IDX-AST-109** | 被呼び出し関係 | | | ○ | △ | | | | |
| **IDX-AST-110** | 使用型一覧 | | | ○ | ● | | | | |
| **IDX-AST-111** | 複雑度計算 | | | ○ | ● | | | | |
| **IDX-AST-112** | 実効行数・コメント行数 | | | ○ | ● | | | | |
| **IDX-AST-113** | 言語固有属性 | | | ○ | ● | | | | |

### 1.4 ベクトル化・登録機能

| 要件ID | 要件概要 | IDX-F01<br>ファイル<br>入力 | IDX-F02<br>除外<br>パターン | IDX-F03<br>AST<br>解析 | IDX-F04<br>メタ<br>データ | IDX-F05<br>ベクトル<br>化要求 | IDX-F06<br>Qdrant<br>登録 | IDX-F07<br>コレク<br>ション | IDX-F08<br>並列<br>処理 |
|--------|---------|------------|------------|------------|------------|------------|------------|------------|------------|
| **IDX-VEC-001** | gRPC通信 | | | | | ● | | | |
| **IDX-VEC-002** | Jina Embeddingsモデル使用 | | | | | ● | | | |
| **IDX-VEC-003** | 最大8192トークン処理 | | | | | ● | | | |
| **IDX-VEC-004** | コード+コメント結合 | | | | ○ | ● | | | |
| **IDX-VEC-005** | バッチリクエスト | | | | | ● | | | ○ |
| **IDX-VEC-006** | リトライ処理 | | | | | ● | | | |
| **IDX-VEC-007** | ヘルスチェック | | | | | ● | | | |
| **IDX-VEC-008** | モデル統一 | | | | | ● | | ○ | |
| **IDX-QDR-001** | 関数単位登録 | | | | | | ● | | |
| **IDX-QDR-002** | 全メタ情報保存 | | | | ○ | | ● | | |
| **IDX-QDR-003** | 共通スキーマ | | | | ○ | | ● | | |

### 1.5 コレクション管理・性能

| 要件ID | 要件概要 | IDX-F01<br>ファイル<br>入力 | IDX-F02<br>除外<br>パターン | IDX-F03<br>AST<br>解析 | IDX-F04<br>メタ<br>データ | IDX-F05<br>ベクトル<br>化要求 | IDX-F06<br>Qdrant<br>登録 | IDX-F07<br>コレク<br>ション | IDX-F08<br>並列<br>処理 |
|--------|---------|------------|------------|------------|------------|------------|------------|------------|------------|
| **IDX-COL-001** | カスタムコレクション名 | | | | | | | ● | |
| **IDX-COL-002** | ディレクトリ名ベース生成 | ○ | | | | | | ● | |
| **IDX-COL-003** | リポジトリ名ベース生成 | - | | | | | | - | |
| **IDX-COL-004** | 既存コレクション削除 | | | | | | | ● | |
| **IDX-COL-005** | リポジトリ独立コレクション | | | | | | | ● | |
| **IDX-PRF-001** | ファイル単位並列処理 | | | | | | | | ● |
| **IDX-PRF-002** | メモリ使用量制御 | | | | | | | | ○ |
| **IDX-PRF-003** | 100万行8時間以内処理 | ○ | ○ | ○ | ○ | ○ | ○ | | ● |

---

## 2. Embedding Server 機能トレーサビリティマトリクス

| 要件ID | 要件概要 | EMB-F01<br>gRPC<br>サーバー | EMB-F02<br>モデル<br>管理 | EMB-F03<br>バッチ<br>埋込 | EMB-F04<br>ヘルス<br>チェック | EMB-F05<br>モデル<br>一覧 | EMB-F06<br>デバイス<br>管理 | EMB-F07<br>エラー<br>処理 | EMB-F08<br>ロギング |
|--------|---------|------------|------------|------------|------------|------------|------------|------------|------------|
| **EMB-001** | gRPCサーバー起動 | ● | | | | | | | |
| **EMB-002** | Jina Embeddingsモデル読込 | | ● | ○ | | | | | |
| **EMB-003** | バッチベクトル化 | | | ● | | | | | |
| **EMB-004** | ヘルスチェックRPC | | | | ● | | | | |
| **EMB-005** | モデル一覧RPC | | | | | ● | | | |
| **EMB-006** | GPU/CPU自動切替 | | | ○ | | | ● | | |
| **EMB-007** | gRPCステータス返却 | | | ○ | ○ | ○ | | ● | |
| **EMB-008** | リクエストログ出力 | | | ○ | | | | | ● |
| **EMB-101** | 複数モデル対応 | | ● | | | | | | |
| **EMB-102** | 遅延ロード | | ● | | | | | | |
| **EMB-103** | モデルキャッシュ | | ● | | | | | | |
| **EMB-104** | デフォルトモデル設定 | | ● | ○ | | | | | |
| **EMB-105** | プリロード対応 | | ● | | | | | | |

---

## 3. MCP Server 機能トレーサビリティマトリクス

| 要件ID | 要件概要 | MCP-F01<br>MCP<br>Protocol | MCP-F02<br>search_code | MCP-F03<br>get_function<br>_details | MCP-F04<br>list_<br>collections | MCP-F05<br>クエリ<br>ベクトル化 | MCP-F06<br>Qdrant<br>検索 |
|--------|---------|------------|------------|------------|------------|------------|------------|
| **MCP-001** | MCP Protocol準拠 | ● | | | | | |
| **MCP-002** | Claude Desktop連携 | ● | | | | | |
| **MCP-003** | 複数ツール提供 | ● | ○ | ○ | ○ | | |
| **MCP-004** | MCPエラーレスポンス | ● | | | | | |
| **MCP-SEARCH-001** | 自然言語クエリ検索 | | ● | | | ○ | ○ |
| **MCP-SEARCH-002** | 関連度順ソート | | ● | | | | ○ |
| **MCP-SEARCH-003** | 検索件数指定 | | ● | | | | ○ |
| **MCP-SEARCH-004** | 言語フィルタ | | ● | | | | ○ |
| **MCP-SEARCH-005** | 複雑度フィルタ | | ● | | | | ○ |
| **MCP-SEARCH-006** | ファイルパスフィルタ | | ● | | | | ○ |
| **MCP-SEARCH-007** | コレクション指定検索 | | ● | | | | ○ |
| **MCP-DETAIL-001** | IDによる関数取得 | | | ● | | | ○ |
| **MCP-DETAIL-002** | 全メタデータ返却 | | | ● | | | ○ |
| **MCP-DETAIL-003** | コレクション指定取得 | | | ● | | | ○ |
| **MCP-LIST-001** | コレクション一覧取得 | | | | ● | | ○ |
| **MCP-LIST-002** | 統計情報返却 | | | | ● | | ○ |
| **MCP-LIST-003** | アクセス制御考慮 | | | | ● | | |

---

## 4. 配布・デプロイメント要件トレーサビリティ

| 要件ID | 要件概要 | 対応章 | 対応状況 | 備考 |
|--------|---------|--------|---------|------|
| **DEP-001** | Goクロスコンパイル | 10.1 | ● | デプロイメント構成で定義 |
| **DEP-002** | Embedding Server Docker配布 | 10.1 | ● | デプロイメント構成で定義 |
| **DEP-003** | MCP Server Docker配布 | 10.1 | ● | デプロイメント構成で定義 |
| **DEP-004** | Docker Compose対応 | 10.1, 10.2 | ● | 起動順序で定義 |
| **DEP-005** | systemdサービスファイル | 10.1 | ○ | 推奨事項として記載 |

---

## 5. 制約事項トレーサビリティ

### 5.1 技術的制約

| 制約ID | 制約内容 | 対応章 | 対応状況 | 備考 |
|--------|---------|--------|---------|------|
| **CNS-001** | 埋め込みモデルPython実行 | 3.1, 4.2 | ● | システム構成で明記 |
| **CNS-002** | gRPCローカル限定(TLS未使用) | 6.1, 9.1 | ● | インターフェース・セキュリティ設計 |
| **CNS-003** | MCP通信stdio限定 | 6.5, 9.1 | ● | インターフェース設計で明記 |
| **CNS-004** | Qdrant 1.7.0以上必要 | 10.1 | ● | デプロイメント要件 |
| **CNS-005** | Go 1.21以上必要 | 2.2, 10.1 | ● | システム構成要素で明記 |
| **CNS-006** | Python 3.11以上必要 | 2.2, 10.1 | ● | システム構成要素で明記 |
| **CNS-007** | UTF-8エンコーディング推奨 | 11.1 | ● | 制約事項で明記 |
| **CNS-008** | モデル統一必須 | 5.2, 6.1, 6.3, 11.1 | ● | データ設計・インターフェース設計 |
| **CNS-009** | データスキーマ統一 | 5.1, 11.1 | ● | データ設計で定義 |

### 5.2 運用上の制約

| 制約ID | 制約内容 | 対応章 | 対応状況 | 備考 |
|--------|---------|--------|---------|------|
| **CNS-101** | Embedding Server事前起動必須 | 10.2 | ● | 起動順序で定義 |
| **CNS-102** | Qdrant事前起動必須 | 10.2 | ● | 起動順序で定義 |
| **CNS-103** | 初回モデルダウンロード | 10.3 | ● | 運用設計で記載 |
| **CNS-104** | コレクション上書き時削除 | 4.1.8, 11.2 | ● | IDX-F07機能で実装 |
| **CNS-105** | モデル変更時再登録必要 | 11.2 | ● | 制約事項で明記 |
| **CNS-106** | gRPCタイムアウト30秒 | 6.1, 6.3, 11.2 | ● | インターフェース設計で定義 |
| **CNS-107** | Claude Desktop経由のみ | 6.5, 11.2 | ● | インターフェース設計で明記 |

---

## 6. 要件カバレッジサマリー

### 6.1 Indexer要件カバレッジ

| カテゴリ | 必須要件 | 推奨要件 | 将来要件 | Phase 1対応 | カバー率 |
|---------|---------|---------|---------|-----------|---------|
| 入力機能 | 4 | 0 | 1 | 4 | 100% |
| AST解析 | 4 | 0 | 0 | 4 | 100% |
| メタデータ抽出 | 8 | 5 | 0 | 12 (1部分) | 92% |
| ベクトル化 | 8 | 0 | 0 | 8 | 100% |
| Qdrant登録 | 3 | 0 | 0 | 3 | 100% |
| コレクション管理 | 4 | 0 | 1 | 4 | 100% |
| **合計** | **31** | **5** | **2** | **35/36** | **97%** |

### 6.2 Embedding Server要件カバレッジ

| カテゴリ | 必須要件 | 推奨要件 | カバー率 |
|---------|---------|---------|---------|
| サーバー機能 | 7 | 1 | 100% |
| モデル管理 | 4 | 1 | 100% |
| **合計** | **11** | **2** | **100%** |

### 6.3 MCP Server要件カバレッジ

| カテゴリ | 必須要件 | 推奨要件 | カバー率 |
|---------|---------|---------|---------|
| MCP Protocol | 4 | 0 | 100% |
| search_code | 3 | 4 | 100% |
| get_function_details | 3 | 0 | 100% |
| list_collections | 2 | 1 | 100% |
| **合計** | **12** | **5** | **100%** |

### 6.4 全体カバレッジ

| 項目 | 件数 |
|------|------|
| **総要件数** | 70 |
| **Phase 1完全対応** | 67 |
| **Phase 1部分対応** | 1 (IDX-AST-109) |
| **Phase 2予定** | 2 (IDX-IN-002, IDX-COL-003) |
| **Phase 1カバー率** | **97%** |

---

## 7. 未対応要件一覧

### 7.1 Phase 2実装予定

| 要件ID | 要件内容 | 優先度 | 対応予定 |
|--------|---------|--------|---------|
| IDX-IN-002 | Gitリポジトリクローン機能 | 将来 | Phase 2 (FUT-001) |
| IDX-COL-003 | リポジトリ名ベースコレクション生成 | 将来 | Phase 2 |

### 7.2 部分対応要件

| 要件ID | 要件内容 | 優先度 | 現状 | Phase 2対応内容 |
|--------|---------|--------|------|---------------|
| IDX-AST-109 | 被呼び出し関係抽出 | 推奨 | データ構造定義済み | 完全な逆引き解析実装 (FUT-004) |

---

## 8. 将来拡張要件との対応

### 8.1 Phase 2機能

| 機能ID | 機能内容 | 関連基本設計機能 | 備考 |
|--------|---------|---------------|------|
| FUT-001 | Gitリポジトリクローン | IDX-F01 | 入力機能の拡張 |
| FUT-002 | 周辺コンテキストベクトル化 | IDX-F04, IDX-F05 | メタデータ拡張 |
| FUT-003 | 差分更新機能 | IDX-F06, IDX-F07 | コレクション管理拡張 |
| FUT-004 | 被呼び出し関係完全解析 | IDX-F04 | メタデータ抽出強化 |
| FUT-005 | gRPC TLS対応 | 6.1, 9.1 | セキュリティ強化 |
| FUT-006 | 埋め込みサーバー動的スケーリング | EMB-F01 | 性能向上 |
| FUT-007 | 意味的コード検索強化 | MCP-F02 | 検索精度向上 |
| FUT-008 | リファクタリング提案ツール | MCP-F01 | 新規ツール追加 |

### 8.2 Phase 3機能

| 機能ID | 機能内容 | 関連基本設計機能 | 備考 |
|--------|---------|---------------|------|
| FUT-101 | Web UI進捗確認 | 10.4 | モニタリング拡張 |
| FUT-102 | 複数リポジトリ一括処理 | IDX-F01, IDX-F07 | バッチ処理機能 |
| FUT-103 | カスタムパーサープラグイン | IDX-F03 | 拡張性向上 |
| FUT-104 | メトリクス可視化 | 10.4 | 運用性向上 |
| FUT-105 | ロードバランシング | EMB-F01 | 高可用性対応 |
| FUT-106 | ストリーミングレスポンス | MCP-F01 | UX向上 |
| FUT-107 | コード生成支援 | MCP-F01 | 新規ツール追加 |

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025-11-25 | 初版作成 |

---

**以上**